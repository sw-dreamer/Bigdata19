# 서울시 범죄 현황 분석

## 학습 목표

- 서울시 구별 범죄 발생과 검거율 지표 사용
- pandas pivot_table 사용법 학습
- Google Maps API 사용하여 지도 정보 획득
- Seaborn(시각화 라이브러리) 사용법 학습
  

## 서울시 경차서벌 범죄 발생과 검거율 데이터 분석
  
```
# csv 파일을 읽어서 데이터프레임으로 생성
import numpy as np
import pandas as pd

crime_anal_police = pd.read_csv(
    './data/02. crime_in_Seoul.csv'
    , thousands=',' # 천자리 구분자 지정 및 콤마 제외와 문자열을 정수로 변환 역할
    ,encoding='euc-kr'
)
crime_anal_police.head()

```
![image](https://github.com/user-attachments/assets/8bbc7bfc-f872-4847-ae99-7a8252ced58d)

## 구글 맵 API 사용해서 경찰서의 위치 정보 받아오기

```
import numpy as np
import pandas as pd

crime_anal_police = pd.read_csv(
    './data/02. crime_in_Seoul.csv'
    , thousands=','
    ,encoding='euc-kr'
)
crime_anal_police['관서명'] # Series 오브젝트
```
![image](https://github.com/user-attachments/assets/5497d3fa-58fc-4c68-9c5d-9784e8a155d5)

```
#구글 map API
import googlemaps # 모듈이 없어서 실패를 한다.
```
![image](https://github.com/user-attachments/assets/07e5be75-481a-4853-a2cd-b984d8d3ecdc)

```
conda install googlemaps # conda로 설치할 때는 Anaconda의 레포지토리를 갖고 와서 실패 할수도 있다.
```
![image](https://github.com/user-attachments/assets/b4e77bd6-bf47-470d-92a2-92b100596d1e)

```
#실패시 아래 명령어를 실행하면 된다.
pip install googlemaps 
```
![image](https://github.com/user-attachments/assets/75b2c621-3484-4b5d-99ce-e65a8e8981a1)


```
import googlemaps # 모듈을 설치하여 성공
```

![image](https://github.com/user-attachments/assets/14929f1c-9028-4fc9-b970-34059cae1f2f)

```
# 구글 map API
# 구글 서버에 접속해서 데이터 요청할 수 있는 클라이언트 생성 처리
import googlemaps

# 클라이언트 생성만 한 것
# 실행 할때 에러가 발생하지 않을것이다.

gmaps_key ='구글 개인키'

gmaps = googlemaps.Client(key=gmaps_key)

# 서울중부경찰서 검색해서 주소 정보 추출
addr_list = gmaps.geocode(
    '서울중부경찰서' # 검색할 문자열
    , language='ko'
)

addr_list
```
![image](https://github.com/user-attachments/assets/108d5747-7577-4178-a6c8-83b151126a0a)

**개인키는 소중한 정보여서 아래 부터는 gmaps_key는 생략하겠습니다.**

```
# 구글 map API
# 구글 서버에 접속해서 데이터 요청할 수 있는 클라이언트 생성 처리

import googlemaps

# 클라이언트 생성만 한 것
# 실행 할때 에러가 발생하지 않을것이다.

gmaps = googlemaps.Client(key=gmaps_key)

# 서울중부경찰서 검색해서 주소 정보 추출
addr_list = gmaps.geocode(
    '서울중부경찰서' # 검색할 문자열
    , language='ko'
)

# 위 addr_list로 주소 추출
addr_list[0].get('formatted_address')
```
![image](https://github.com/user-attachments/assets/dad05856-342b-4003-9a6c-9ddacceff29a)

```
# 구글 map API
import googlemaps


gmaps = googlemaps.Client(key=gmaps_key)

addr_list = gmaps.geocode(
    '서울중부경찰서' 
    , language='ko'
)

addr_list[0].get('geometry')
```
![image](https://github.com/user-attachments/assets/e9119761-fe1a-43f4-93de-5c79b33cb399)

```
# 구글 map API
import googlemaps


gmaps = googlemaps.Client(key=gmaps_key)

addr_list = gmaps.geocode(
    '서울중부경찰서' 
    , language='ko'
)

addr_list[0].get('geometry')['location']
```
![image](https://github.com/user-attachments/assets/86e7c49e-0cd1-4c93-afe0-ea0c5081e93a)

```
# 구글 map API
import googlemaps


gmaps = googlemaps.Client(key=gmaps_key)

addr_list = gmaps.geocode(
    '서울중부경찰서' 
    , language='ko'
)

addr_list[0].get('geometry')['location']['lat']
```
![image](https://github.com/user-attachments/assets/965001bb-ebbb-4802-b02f-9aa368c1515d)

```
# 관서명 : 31개
# 중부서를 서울 중부 경찰서로 바꾸는 작업이 필요
import numpy as np
import pandas as pd

crime_anal_police = pd.read_csv(
    './data/02. crime_in_Seoul.csv'
    , thousands=','
    ,encoding='euc-kr'
)
crime_anal_police['관서명'][0]
```
![image](https://github.com/user-attachments/assets/07df4db7-a34f-4c28-aaf9-3098e2fef3fe)

```
# 관서명 : 31개
# 중부서를 서울 중부 경찰서로 바꾸는 작업이 필요
import numpy as np
import pandas as pd

crime_anal_police = pd.read_csv(
    './data/02. crime_in_Seoul.csv'
    , thousands=','
    ,encoding='euc-kr'
)

name = crime_anal_police['관서명'][0]


print('서울'+name[:-1]+'경찰서')

```
![image](https://github.com/user-attachments/assets/f9b5e7fe-3b45-4e09-86bc-8728321b2655)

```
# 관서명 : 31개
# 예를 들어 중부서를 서울 중부 경찰서로 바꾸는 작업이 필요
import numpy as np
import pandas as pd

crime_anal_police = pd.read_csv(
    './data/02. crime_in_Seoul.csv'
    , thousands=','
    ,encoding='euc-kr'
)

# 1. 기존 관서명 (OO서) => 서울OO경찰서로 변경
station_name= [] # 변경된 관서명을 저장하는 리스트

for name in crime_anal_police['관서명']:
    station_name.append('서울'+name[:-1]+'경찰서')

station_name
```
![image](https://github.com/user-attachments/assets/35967cb7-99ee-4752-9774-34237b45f81b)

```
# 관서명 : 31개
# 예를 들어 중부서를 서울 중부 경찰서로 바꾸는 작업이 필요
import numpy as np
import pandas as pd

crime_anal_police = pd.read_csv(
    './data/02. crime_in_Seoul.csv'
    , thousands=','
    ,encoding='euc-kr'
)

# 1. 기존 관서명 (OO서) => 서울OO경찰서로 변경
station_name= [] # 변경된 관서명을 저장하는 리스트

for name in crime_anal_police['관서명']:
    station_name.append('서울'+name[:-1]+'경찰서') #문자열 + 오브젝트+ 문자열 이어서 오류가 발생할 수 도 있다.

crime_anal_police['관서명'].dtype
```
![image](https://github.com/user-attachments/assets/1246e718-8350-4c3b-a093-640861ab87b0)

```
# 오류가 발생하면 아래와 같이 실행하면 된다.
import numpy as np
import pandas as pd

crime_anal_police = pd.read_csv(
    './data/02. crime_in_Seoul.csv'
    , thousands=','
    ,encoding='euc-kr'
)

# 1. 기존 관서명 (OO서) => 서울OO경찰서로 변경
station_name= [] # 변경된 관서명을 저장하는 리스트

for name in crime_anal_police['관서명']:
    station_name.append('서울'+str(name[:-1])+'경찰서')

station_name
```
![image](https://github.com/user-attachments/assets/1b586e44-b456-4bc1-9480-499f5922a36a)

```
import numpy as np
import pandas as pd
import googlemaps

crime_anal_police = pd.read_csv(
    './data/02. crime_in_Seoul.csv'
    , thousands=','
    ,encoding='euc-kr'
)

station_name= []

for name in crime_anal_police['관서명']:
    station_name.append('서울'+str(name[:-1])+'경찰서')

gmaps = googlemaps.Client(key=gmaps_key)

# 구글 map에서 3개 지도 정보 추출
# 전체 주소, 위도, 경도
# 위 정보를 저장하는 저장소 : list 
station_address=[]
station_lat=[]
station_lng=[]

for name in station_name: # name : 서울OOO경찰서 경찰서명이 31번 반복
    # 구글 지도 서버에 경찰서명 보내서 지도 정보를 받는다
    tmp = gmaps.geocode(
        name 
        , language='ko'
    )
    # 전체 정보 추출해서 station_address에 추가
    station_address.append(tmp[0].get('formatted_address'))
    # lat,lng 추출
    tmp_loc = tmp[0].get('geometry')
    station_lat.append(tmp_loc['location']['lat'])
    station_lng.append(tmp_loc['location']['lng'])
    
    # 경찰서 정보 출력 : 경찰서명, 전체 주소 출력
    print(name + '------>' + tmp[0].get('formatted_address'))
```
![image](https://github.com/user-attachments/assets/25c9a6d2-9e8f-4c4d-a154-7c2dcecfa4eb)

```
import pickle

with open('./data/station_address.pickle','wb') as f:
    pickle.dump(station_address,f)

with open('./data/station_lat.pickle','wb') as f:
    pickle.dump(station_lat,f)

with open('./data/station_lng.pickle','wb') as f:
    pickle.dump(station_lng,f)

```
![image](https://github.com/user-attachments/assets/8ac1c5cd-5030-4e6e-ba90-868803e807ad)

```
# 전체 주소에서 구를 추출

gu='대한민국 서울특별시 성북구 보문로 170'

print(gu.split()) #전체 주소를 공백으로 분리 리스트 변환

print('----------------------------------------------------')
for addr in gu.split():
    if addr[-1] =='구':
        print(addr)
```
![image](https://github.com/user-attachments/assets/887a7542-2906-4c1c-b5a3-fb2a655c755a)
