# 셀프 주유소의 휘발유 가격 분석

---
1. Selenium Library 사용
   - 원래 목적은 웹 애플리케이션 개발, 자동화 테스트를 하기 위해 만들어짐
   - 데이터 수집에 사용할 것이다.
   - selenium.webdriver : 데이터 수집에 사용
     - **웹브라우저를 제어**하고 자동화할 수 있는 API 제공
     - 다양한 브라우저 제어
2. Webdriver module
   - 브라우저 제어
     - get(url) : 지정된 url로 이동
     - back(), forward(), refresh() 등
     - maxmize_window() : 브라우저 창을 최대화
     - close() : 현재 탭 삭제
     - quit() : 전체브리핑 닫기
   - 요소 찾기
     - find_element(BY.ID, '찾고자할 id명')
     - find_element(BY.NAME, '찾고자할 태그명')
     - find_element(BY.CLASS_NAME, '찾고자할 class명')
     - find_element(BY.TAG, '찾고자할 Tag')
     - find_element(BY.CSS_Selector, 'css selector')
     - find_element(BY.XPATH, '찾고자할 xpath명') ※ xpath은 select 축약
   - 상호작용 처리
     - click() : 특정 태그를 클릭 할 때 사용
     - send_key('value') : 해당 요소에 텍스트로 value가 입력되게 할 때 사용
     - clear() : 특정 요소의 입력값을 삭제할 때 사용
     - submit() : 서버로 데이터 전송할 때 사용
     - execute_script('js code') : 자바스크립트 코드 실행


---
## Selenium 사용하기
```
pip install selenium 
```
![image](https://github.com/user-attachments/assets/c3ead0a8-cdd4-47c1-9e2d-4262a225896e)

```
# 네이버 자동 로그인 처리 : 에러 난다
from selenium import webdriver
from selenium.webdriver.common.by import By

driver=webdriver.Chrome() # 크롬 브라우저를 다룰 수 있는 오브젝트 생성
driver.get('https://nid.naver.com/nidlogin.login?mode=form&url=https://www.naver.com/')

```
![image](https://github.com/user-attachments/assets/d70f5dfb-bcbf-411b-99f7-d6321d24e812)

```
# 네이버 자동 로그인 처리 : 에러 난다
from selenium import webdriver
from selenium.webdriver.common.by import By

driver=webdriver.Chrome() # 크롬 브라우저를 다룰 수 있는 오브젝트 생성
driver.get('https://nid.naver.com/nidlogin.login?mode=form&url=https://www.naver.com/')

naver_id='abc'
naver_password='1234'

# id 입력하는 textbox 선택
id_box=driver.find_element(By.ID,'id')
id_box.send_keys(naver_id)

```
![image](https://github.com/user-attachments/assets/a72e36e4-a9ad-4e6b-9430-3bc03e7f7c68)

```
# 네이버 자동 로그인 처리 : 에러 난다
from selenium import webdriver
from selenium.webdriver.common.by import By

driver=webdriver.Chrome() # 크롬 브라우저를 다룰 수 있는 오브젝트 생성
driver.get('https://nid.naver.com/nidlogin.login?mode=form&url=https://www.naver.com/')

naver_id='abc'
naver_password='1234'

# id 입력하는 textbox 선택
id_box=driver.find_element(By.ID,'id')
id_box.send_keys(naver_id)

# 비밀번호 입력하는 textbox 선택
pw_box=driver.find_element(By.ID,'pw')
pw_box.send_keys(naver_password)

```
![image](https://github.com/user-attachments/assets/c437d42e-ede4-4f19-bc4d-964dee130b42)

```
# 네이버 자동 로그인 처리 : 에러 난다
from selenium import webdriver
from selenium.webdriver.common.by import By

driver=webdriver.Chrome() # 크롬 브라우저를 다룰 수 있는 오브젝트 생성
driver.get('https://nid.naver.com/nidlogin.login?mode=form&url=https://www.naver.com/')

naver_id='abc'
naver_password='1234'

# id 입력하는 textbox 선택
id_box=driver.find_element(By.ID,'id')
id_box.send_keys(naver_id)

# 비밀번호 입력하는 textbox 선택
pw_box=driver.find_element(By.ID,'pw')
pw_box.send_keys(naver_password)

# 로그인 버튼 누르기
login_button=driver.find_element(By.ID,'log.login')
login_button.click()
```
![image](https://github.com/user-attachments/assets/5d64ba9d-fd3e-47cf-a19a-6d7d3628c0ea)

```
# 네이버 자동 로그인 처리 : 에러 난다
from selenium import webdriver
from selenium.webdriver.common.by import By

driver=webdriver.Chrome() # 크롬 브라우저를 다룰 수 있는 오브젝트 생성
driver.get('https://nid.naver.com/nidlogin.login?mode=form&url=https://www.naver.com/')

naver_id='abc'
naver_password='1234'

# id 입력하는 textbox 선택
id_box=driver.find_element(By.ID,'id')
id_box.send_keys(naver_id)

# 비밀번호 입력하는 textbox 선택
pw_box=driver.find_element(By.ID,'pw')
pw_box.send_keys(naver_password)

# 로그인 버튼 누르기
login_button=driver.find_element(By.ID,'log.login')
login_button.click()

# 브라우저 닫기
driver.close()
```

---
## 주유소 데이터 습격

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

# 브라우저 오브젝트를 생성
driver=webdriver.Chrome()

# 화면 출력
driver.get('https://www.opinet.co.kr/searRgSelect.do')
```
![image](https://github.com/user-attachments/assets/98b5eda1-530e-4879-8a55-bdf45204aace)

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

# Initialize the WebDriver
driver = webdriver.Chrome()

# Open the target URL
driver.get('https://www.opinet.co.kr/searRgSelect.do')

# Wait for the select element to be present (e.g., up to 10 seconds)
try:
    gu_list_raw = WebDriverWait(driver, 10).until(
        EC.presence_of_element_located((By.XPATH, '//*[@id="SIGUNGU_NM0"]'))
    )
    
    # Extract the options and store them in a list
    gu_names = []
    gu_list = gu_list_raw.find_elements(By.TAG_NAME, 'option')
    
    for option in gu_list:
        gu_names.append(option.text)
    
    # Print the result as a list
    print(gu_names[1:])
    
except Exception as e:
    print(f"Error: {str(e)}")
finally:
    driver.quit()
```
![image](https://github.com/user-attachments/assets/cce372a9-c052-40a8-9148-bd599afc6959)

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from tqdm import tqdm
import time

chrome_options = Options()

driver = webdriver.Chrome(options=chrome_options)

try:
    driver.get('https://www.opinet.co.kr/searRgSelect.do')
    

    gu_list_raw = WebDriverWait(driver, 10).until(
        EC.presence_of_element_located((By.XPATH, '//*[@id="SIGUNGU_NM0"]'))
    )
    

    gu_list = gu_list_raw.find_elements(By.TAG_NAME, 'option')
    gu_names = [option.text for option in gu_list]
    

    for gu in tqdm(gu_names[1:]):
        print('-----------------------------------------------------------')
        print(f"Processing: {gu}")
        print('-----------------------------------------------------------')
        
         # 1. select box 선택
        select_element = WebDriverWait(driver, 10).until(
            EC.element_to_be_clickable((By.ID, 'SIGUNGU_NM0'))
        )
        select_element.send_keys(gu)
        
        # 서버에서 데이터가 오는 것을 2초 기다려라
        time.sleep(2)
        
        # 2. 조회 버튼 클릭 : searRgSelect
        search_element = WebDriverWait(driver, 10).until(
            EC.element_to_be_clickable((By.ID, 'searRgSelect'))
        )
        search_element.click()
        
        # 서버에서 데이터가 오는 것을 5초 기다려라
        time.sleep(5)
        
        # 3. 엑셀 저장 버튼 선택, 클릭 -> 해당 구의 엑셀파일 다운로드가 된다.
        try:
            excel_xpath = '//*[@id="templ_list0"]/div[7]/div/a'
            excel_element = WebDriverWait(driver, 10).until(
                EC.element_to_be_clickable((By.XPATH, excel_xpath))
            )
            excel_element.click()
            
            print(f"Downloading Excel for {gu}...")
            time.sleep(10)
            
        except Exception as e:
            print(f"Error downloading Excel for {gu}: {str(e)}")

except Exception as e:
    print(f"Main error: {str(e)}")
    
finally:
    print("Closing browser...")
    driver.quit()
```
![image](https://github.com/user-attachments/assets/686cd4f4-c6e4-46a8-bacf-79872277da0e)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

driver=webdriver.Chrome()
driver.get('https://www.opinet.co.kr/searRgSelect.do')

# 1. 서울시 고정, 구별 정보 추출
# select box value 추출
# 1.1 select box search selection
x_path='//*[@id="SIGUNGU_NM0"]'
gu_list_raw=driver.find_element(By.XPATH, '//*[@id="SIGUNGU_NM0"]')
gu_list=gu_list_raw.find_elements(By.TAG_NAME, 'option')
gu_list
```
![image](https://github.com/user-attachments/assets/3212bfc5-17cb-42a0-932f-f89e94f71d94)

```
gu_name = [option.get_attribute('value') for option in gu_list]

gu_name.remove('')

from tqdm import tqdm
import time #sleep

for gu in gu_name:
    #select box 선택
    select_element=driver.find_element(By.ID, 'SIGUNGU_NM0')
    # select box 값으로 보내서 데이터 갱신 : 강남구
    select_element.send_keys(gu)
    
    time.sleep(2) # 서버에서 데이터가 오는 것을 2초를 기다려라
    
    # 2. 조회 버튼 클릭 : searRgSelect
    search_element=driver.find_element(By.ID,'searRgSelect')
    search_element.click()
    
    time.sleep(2)
    
    x_path='//*[@id="templ_list0"]/div[7]/div/a'
    excel_element=driver.find_element(By.XPATH,x_path)
    excel_element.click()
    
    time.sleep(2)
```
![image](https://github.com/user-attachments/assets/6b29d7cd-c63f-4b9f-9398-beedd46020e1)

---
## 다운한 파일 데이터 분석

- 엑셀 파일을 로딩해서 데이터프레임 변환
- 25개 파일 -> 파일 목록 필요

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

print ("file_list: {}".format(file_list)) # xls 뿐만 아니라 모든 파일 리스트를 갖고 온다.

# glob('경로/파일명패턴(?.*)')
glob('./oil_data/*.xls') # 해당 디렉토리이 안에 있는 파일 목록(문자열)을 리스트로 출력
```
![image](https://github.com/user-attachments/assets/e1c15a3d-f84c-4131-87b0-8408dc821584)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

# 파일 목록 저장
station_files=glob('./oil_data/*.xls') 
station_files[:15]
```
![image](https://github.com/user-attachments/assets/386487d1-ff02-48fc-b5dd-4b9307f97b67)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

# 파일 목록 저장
station_files=glob('./oil_data/*.xls') 

# 구별(25개) 데이터프레임을 저장할 임시 리스트
tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) #위에 읽어온 데이터프레임을 리스트에 추가

tmp_df_list
```
![image](https://github.com/user-attachments/assets/36acd995-26af-4968-b65d-7ad0b6a4e056)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

# 파일 목록 저장
station_files=glob('./oil_data/*.xls') 

# 구별(25개) 데이터프레임을 저장할 임시 리스트
tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) #위에 읽어온 데이터프레임을 리스트에 추가

tmp_df_list[0]
```
![image](https://github.com/user-attachments/assets/df155bb9-3e3d-4fde-aa0b-dad1aaa0f80e)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

# 리스트에 들어있는 25개 데이터프레임 통합
station_raw = pd.concat(
    tmp_df_list
) # 데이터프레임 반환

station_raw.info()
```
![image](https://github.com/user-attachments/assets/d0f2241a-1c7f-44fb-a7ea-0a7148c4d3c1)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

stations.head()
```
![image](https://github.com/user-attachments/assets/c7b7b61a-e55d-49c2-9443-c3e1b2d3507b)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]
stations['구']
```
![image](https://github.com/user-attachments/assets/dffef813-adce-4d2a-9c75-695d9baac78c)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 구 데이터 처리 정상인지 확인
for gu in stations['구']:
    if gu.endswith('구'): # 구로 끝날 경우 True 반환
        pass
    else : # '구'로 끝나지 않는 경우
        print(gu)
```
![image](https://github.com/user-attachments/assets/4269b395-a4ed-49b3-9949-1e2b375857b6)

'구'로 끝나지 않는 경우가 존재하지 않는다.

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 휘발유 가격 이상값 확인
stations[stations['가격'] =='-']
```
![image](https://github.com/user-attachments/assets/838dade7-a861-4b41-b205-a8901dcfd810)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# boolean type에 sum을 하면 True는 1로 처리하고 False는 0으로 처리
(stations['가격']=='-').sum()
```
![image](https://github.com/user-attachments/assets/edc1b866-d7f6-4629-b41b-55e8db34021e)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

stations['가격']
```
![image](https://github.com/user-attachments/assets/857d06bc-a237-44b4-8c28-e19333f84380)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

stations.index
```
![image](https://github.com/user-attachments/assets/6f6d3dde-9227-4836-b7e7-b0574b5b1468)

index값이 0,1,2,3,4, .....,29로 있는데 전체 데이터 값이 422개여서 중복이 되는것으로 유추된다.

좀더 확실하게 보기 위해서 슬라이싱 진행
```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

stations.index[:50]
```
![image](https://github.com/user-attachments/assets/d9208b1e-b07b-49b2-80fe-097fa56c8cc1)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋
stations.reset_index(inplace=True)

stations.index
```
![image](https://github.com/user-attachments/assets/42c5da0b-b05f-4859-aa08-4866aa59c6ca)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋
stations.reset_index(inplace=True)

stations
```
![image](https://github.com/user-attachments/assets/5d4e9747-83c0-4e68-ac0b-ab688481bbee)

> reset_index 실행시 주의사항 : 기존 인덱스 값을 컬럼으로 만든다

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋
stations.reset_index(inplace=True) # integer index

list(stations.index[:50])
```
![image](https://github.com/user-attachments/assets/86d40b7a-1445-408e-93bf-6994eb4e0cb4)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

stations.head()
```
![image](https://github.com/user-attachments/assets/b62cd785-ec67-4c71-92f9-5d0e0b37c025)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

# 셀프(조건) 주유소의 휘발유 가격이 정말 저렴한지를 시각화
# 1. 데이터 프레임에 boxplot이 있다.
 

import matplotlib.pyplot as plt
import seaborn as sns

import matplotlib as mpl
from matplotlib import rcParams # matplotlib 환경설정 모듈
rcParams['font.family'] = 'Malgun Gothic' # 한글 글꼴 설정
rcParams['axes.unicode_minus'] = False

stations.boxplot(
    column='가격' # 가격 비교
    , by='셀프' # 조건 지정
    , figsize=(12,8)
)
```
![image](https://github.com/user-attachments/assets/477b4058-4071-43da-9297-a4636a3dc366)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

# 상표별 주유소의 휘발유 가격 시각화
stations['상표'].unique()

```
![image](https://github.com/user-attachments/assets/dbeefbb6-f5ff-4f67-850c-4eb5b4135d90)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

# 상표별 주유소의 휘발유 가격 시각화

import matplotlib.pyplot as plt
import seaborn as sns

import matplotlib as mpl
from matplotlib import rcParams # matplotlib 환경설정 모듈
rcParams['font.family'] = 'Malgun Gothic' # 한글 글꼴 설정
rcParams['axes.unicode_minus'] = False

stations.boxplot(
    column='가격' # 가격 비교
    , by='상표' # 조건 지정
    , figsize=(12,8)
)
```
![image](https://github.com/user-attachments/assets/8002e3cb-df5c-4838-9364-5bc8dce2c903)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

# 상표별 주유소의 휘발유 가격 시각화

import matplotlib.pyplot as plt
import seaborn as sns

import matplotlib as mpl
from matplotlib import rcParams # matplotlib 환경설정 모듈
rcParams['font.family'] = 'Malgun Gothic' # 한글 글꼴 설정
rcParams['axes.unicode_minus'] = False

# sns 사용해서 boxplot

plt.figure(figsize=(12,8))

sns.boxplot(
    data=stations
    ,x='상표'
    ,y='가격'
    , hue='셀프'
    , palette='Set3'
)
plt.show()
```
![image](https://github.com/user-attachments/assets/dc7af027-0d31-4716-bb21-46e5df09835c)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

# 상표별 주유소의 휘발유 가격 시각화

import matplotlib.pyplot as plt
import seaborn as sns

import matplotlib as mpl
from matplotlib import rcParams # matplotlib 환경설정 모듈
rcParams['font.family'] = 'Malgun Gothic' # 한글 글꼴 설정
rcParams['axes.unicode_minus'] = False

# sns 사용해서 boxplot

plt.figure(figsize=(12,8))

sns.boxplot(
    data=stations
    ,x='상표'
    ,y='가격'
    , hue='셀프'
    , palette='Set3'
)
sns.swarmplot( #데이터 분포 확인
    x='상표'
    ,y='가격'
    ,data=stations
    ,color='0.6'
)
plt.show()
```
![image](https://github.com/user-attachments/assets/993d2604-eed2-4ee9-96cb-ebf17ff3e8e7)

---
## 분석, 지도 시각화

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

import json
import folium
import googlemaps

import seaborn as sns
import matplotlib.pyplot as plt

import matplotlib as mpl
from matplotlib import rcParams # matplotlib 환경설정 모듈
rcParams['font.family'] = 'Malgun Gothic' # 한글 글꼴 설정
rcParams['axes.unicode_minus'] = False

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

# 지도 시각화
# 1. 구별 평균 가격
# 2. 상위 10개, 하위 10개 주유소를 시각화(위도, 경도)

# 상위 10개
stations.sort_values(by='가격',ascending=False).head(10)
```
![image](https://github.com/user-attachments/assets/9fbd6819-e029-4434-8ded-fd830f58824e)

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

import json
import folium
import googlemaps

import seaborn as sns
import matplotlib.pyplot as plt

import matplotlib as mpl
from matplotlib import rcParams # matplotlib 환경설정 모듈
rcParams['font.family'] = 'Malgun Gothic' # 한글 글꼴 설정
rcParams['axes.unicode_minus'] = False

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

# 지도 시각화
# 1. 구별 평균 가격
# 2. 상위 10개, 하위 10개 주유소를 시각화(위도, 경도)

# 하위 10개
stations.sort_values(by='가격',ascending=True).head(10)
```
![image](https://github.com/user-attachments/assets/882219aa-e308-4893-94a8-815b7e01de89)

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

import json
import folium
import googlemaps

import seaborn as sns
import matplotlib.pyplot as plt

import matplotlib as mpl
from matplotlib import rcParams # matplotlib 환경설정 모듈
rcParams['font.family'] = 'Malgun Gothic' # 한글 글꼴 설정
rcParams['axes.unicode_minus'] = False

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

# 지도 시각화
# 1. 구별 평균 가격
# 2. 상위 10개, 하위 10개 주유소를 시각화(위도, 경도)

# 구별(그룹) 평균(agg) 가격

gu_data=pd.pivot_table( # 인덱스로 오름차순 정렬한 결과를 dataframe로 반환
    data=stations
    , index=['구'] # 인덱스에 들어가는 값 그룹핑한다.
    , values=['가격']
    , aggfunc=np.mean
)
gu_data
```
![image](https://github.com/user-attachments/assets/28c84f20-14fe-42b0-9c6a-4e1b4d47310e)

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

import json
import folium
import googlemaps

import seaborn as sns
import matplotlib.pyplot as plt

import matplotlib as mpl
from matplotlib import rcParams # matplotlib 환경설정 모듈
rcParams['font.family'] = 'Malgun Gothic' # 한글 글꼴 설정
rcParams['axes.unicode_minus'] = False

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

# 지도 시각화
# 1. 구별 평균 가격
# 2. 상위 10개, 하위 10개 주유소를 시각화(위도, 경도)

# 구별(그룹) 평균(agg) 가격

gu_data=pd.pivot_table( 
    data=stations
    , index=['구']
    , values=['가격']
    , aggfunc=np.mean
)
gu_data.sort_values(by='가격',ascending=False)
```
![image](https://github.com/user-attachments/assets/6f5dde72-ba37-4ca3-acef-4bc1868e8e75)

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

import json
import folium
import googlemaps

import seaborn as sns
import matplotlib.pyplot as plt

import matplotlib as mpl
from matplotlib import rcParams # matplotlib 환경설정 모듈
rcParams['font.family'] = 'Malgun Gothic' # 한글 글꼴 설정
rcParams['axes.unicode_minus'] = False

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

# 지도 시각화
# 1. 구별 평균 가격
# 2. 상위 10개, 하위 10개 주유소를 시각화(위도, 경도)

# 구별(그룹) 평균(agg) 가격

gu_data=pd.pivot_table( # 인덱스로 오름차순 정렬한 결과를 dataframe로 반환
    data=stations
    , index=['구'] # 인덱스에 들어가는 값 그룹핑한다.
    , values=['가격']
    , aggfunc=np.mean
)

# 서울시 구를 경계로한 지도 표시
geo_path='./data/02. skorea_municipalities_geo_simple.json'
geo_str=json.load(
    open(
        geo_path,encoding='utf-8'
        )
    )
geo_str
```
![image](https://github.com/user-attachments/assets/1253e2ed-85ed-4f87-b6af-321562208a38)

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

import json
import folium
import googlemaps

import seaborn as sns
import matplotlib.pyplot as plt

import matplotlib as mpl
from matplotlib import rcParams # matplotlib 환경설정 모듈
rcParams['font.family'] = 'Malgun Gothic' # 한글 글꼴 설정
rcParams['axes.unicode_minus'] = False

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

# 지도 시각화
# 1. 구별 평균 가격
# 2. 상위 10개, 하위 10개 주유소를 시각화(위도, 경도)

# 구별(그룹) 평균(agg) 가격

gu_data=pd.pivot_table( # 인덱스로 오름차순 정렬한 결과를 dataframe로 반환
    data=stations
    , index=['구'] # 인덱스에 들어가는 값 그룹핑한다.
    , values=['가격']
    , aggfunc=np.mean
)

# 서울시 구를 경계로한 지도 표시
geo_path='./data/02. skorea_municipalities_geo_simple.json'
geo_str=json.load(
    open(
        geo_path,encoding='utf-8'
        )
    )

# 지도 생성
map=folium.Map(
    location=[37.5502,126.982]
    ,zoom_start=11
)
map
```
![image](https://github.com/user-attachments/assets/777e8900-8a43-4243-9fde-41c9896b47f9)

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

import json
import folium
import googlemaps

import seaborn as sns
import matplotlib.pyplot as plt

import matplotlib as mpl
from matplotlib import rcParams # matplotlib 환경설정 모듈
rcParams['font.family'] = 'Malgun Gothic' # 한글 글꼴 설정
rcParams['axes.unicode_minus'] = False

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

# 지도 시각화
# 1. 구별 평균 가격
# 2. 상위 10개, 하위 10개 주유소를 시각화(위도, 경도)

# 구별(그룹) 평균(agg) 가격

gu_data=pd.pivot_table( # 인덱스로 오름차순 정렬한 결과를 dataframe로 반환
    data=stations
    , index=['구'] # 인덱스에 들어가는 값 그룹핑한다.
    , values=['가격']
    , aggfunc=np.mean
)

# 서울시 구를 경계로한 지도 표시
geo_path='./data/02. skorea_municipalities_geo_simple.json'
geo_str=json.load(
    open(
        geo_path,encoding='utf-8'
        )
    )

# 지도 생성
map=folium.Map(
    location=[37.5502,126.982]
    ,zoom_start=11
)

# 구별 경계선 : Choropleth
folium.Choropleth(
    geo_data=geo_str # 경계선 데이터 지정
    ,data=gu_data # 구별 색상값, 구별 평균 가격
    , columns=[gu_data.index,'가격']
    ,fill_color='PuRd'
    ,key_on='feature.id' #경계선 데이터에 있는 구 추출
).add_to(map)

map
```
![image](https://github.com/user-attachments/assets/cb8d98be-2e89-464b-b63d-0ada6a94e495)

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

import json
import folium
import googlemaps

import seaborn as sns
import matplotlib.pyplot as plt

import matplotlib as mpl
from matplotlib import rcParams # matplotlib 환경설정 모듈
rcParams['font.family'] = 'Malgun Gothic' # 한글 글꼴 설정
rcParams['axes.unicode_minus'] = False

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

# 지도 시각화
# 1. 구별 평균 가격
# 2. 상위 10개, 하위 10개 주유소를 시각화(위도, 경도)

# 구별(그룹) 평균(agg) 가격

gu_data=pd.pivot_table( # 인덱스로 오름차순 정렬한 결과를 dataframe로 반환
    data=stations
    , index=['구'] # 인덱스에 들어가는 값 그룹핑한다.
    , values=['가격']
    , aggfunc=np.mean
)

# 서울시 구를 경계로한 지도 표시
geo_path='./data/02. skorea_municipalities_geo_simple.json'
geo_str=json.load(
    open(
        geo_path,encoding='utf-8'
        )
    )

# 지도 생성
map=folium.Map(
    location=[37.5502,126.982]
    ,zoom_start=11
)

# 구별 경계선 : Choropleth
folium.Choropleth(
    geo_data=geo_str # 경계선 데이터 지정
    ,data=gu_data # 구별 색상값, 구별 평균 가격
    , columns=[gu_data.index,'가격']
    ,fill_color='PuRd'
    ,key_on='feature.id' #경계선 데이터에 있는 구 추출
).add_to(map)

# 상위 10개, 하위10개 변수 선언 저장
oil_price_top10 = stations.sort_values(by='가격',ascending=False).head(10)
oil_price_bottom10 = stations.sort_values(by='가격',ascending=True).head(10)

# 구글 주소 검색 설정
# gmas_key='개인키'
gmaps=googlemaps.Client(key=gmas_key)


# 상위 10개 주소에서 위도,경도 추출
from tqdm import tqdm

lat=[]
lng=[]
err=[]

for idx in tqdm(oil_price_top10.index):
    try:
        tmp_addr= oil_price_top10['주소'][idx].split('(')[0]
        tmp_map=gmaps.geocode(tmp_addr) # 잘못된 주소에 의한 에러 발생 가능
        
        tmp_loc=tmp_map[0].get('geometry')
        lat.append(tmp_loc['location']['lat'])
        
        tmp_lng=tmp_map[0].get('geometry')
        lng.append(tmp_loc['location']['lng'])
        
    except: #잘못된 주소가 있는 경우
        lat.append(np.nan)
        lng.append(np.nan)
        print('잘못된 주소 :'+idx)
        err.append(idx)

print('lat :',lat)
print('lng : ',lng)
print('err : ',err)
```
![image](https://github.com/user-attachments/assets/c9d261c5-11d0-4d3e-88af-44174bd801bf)

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

import json
import folium
import googlemaps

import seaborn as sns
import matplotlib.pyplot as plt

import matplotlib as mpl
from matplotlib import rcParams # matplotlib 환경설정 모듈
rcParams['font.family'] = 'Malgun Gothic' # 한글 글꼴 설정
rcParams['axes.unicode_minus'] = False

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

# 지도 시각화
# 1. 구별 평균 가격
# 2. 상위 10개, 하위 10개 주유소를 시각화(위도, 경도)

# 구별(그룹) 평균(agg) 가격

gu_data=pd.pivot_table( # 인덱스로 오름차순 정렬한 결과를 dataframe로 반환
    data=stations
    , index=['구'] # 인덱스에 들어가는 값 그룹핑한다.
    , values=['가격']
    , aggfunc=np.mean
)

# 서울시 구를 경계로한 지도 표시
geo_path='./data/02. skorea_municipalities_geo_simple.json'
geo_str=json.load(
    open(
        geo_path,encoding='utf-8'
        )
    )

# 지도 생성
map=folium.Map(
    location=[37.5502,126.982]
    ,zoom_start=11
)

# 구별 경계선 : Choropleth
folium.Choropleth(
    geo_data=geo_str # 경계선 데이터 지정
    ,data=gu_data # 구별 색상값, 구별 평균 가격
    , columns=[gu_data.index,'가격']
    ,fill_color='PuRd'
    ,key_on='feature.id' #경계선 데이터에 있는 구 추출
).add_to(map)

# 상위 10개, 하위10개 변수 선언 저장
oil_price_top10 = stations.sort_values(by='가격',ascending=False).head(10)
oil_price_bottom10 = stations.sort_values(by='가격',ascending=True).head(10)

# 구글 주소 검색 설정
# gmas_key='개인키'
gmaps=googlemaps.Client(key=gmas_key)


# 상위 10개 주소에서 위도,경도 추출
from tqdm import tqdm

toplat=[]
toplng=[]
toperr=[]

for idx in tqdm(oil_price_top10.index):
    try:
        tmp_addr= oil_price_top10['주소'][idx].split('(')[0]
        tmp_map=gmaps.geocode(tmp_addr) # 잘못된 주소에 의한 에러 발생 가능
        
        tmp_loc=tmp_map[0].get('geometry')
        toplat.append(tmp_loc['location']['lat'])
        
        tmp_lng=tmp_map[0].get('geometry')
        toplng.append(tmp_loc['location']['lng'])
        
    except: #잘못된 주소가 있는 경우
        toplat.append(np.nan)
        toplng.append(np.nan)
        print('잘못된 주소 :'+idx)
        toperr.append(idx)

# Dataframe에 lat,lng 추가
oil_price_top10['lat']= toplat
oil_price_top10['lng']=toplng


bottomlat=[]
bottomlng=[]
bottomerr=[]

for idx in tqdm(oil_price_bottom10.index):
    try:
        tmp_addr= oil_price_bottom10['주소'][idx].split('(')[0]
        tmp_map=gmaps.geocode(tmp_addr) # 잘못된 주소에 의한 에러 발생 가능
        
        tmp_loc=tmp_map[0].get('geometry')
        bottomlat.append(tmp_loc['location']['lat'])
        
        tmp_lng=tmp_map[0].get('geometry')
        bottomlng.append(tmp_loc['location']['lng'])
        
    except: #잘못된 주소가 있는 경우
        bottomlat.append(np.nan)
        bottomlng.append(np.nan)
        print('잘못된 주소 :'+idx)
        bottomerr.append(idx)

# Dataframe에 lat,lng 추가
oil_price_bottom10['lat']= bottomlat
oil_price_bottom10['lng']=bottomlng

oil_price_top10
```
![image](https://github.com/user-attachments/assets/bcc46593-4bec-42b0-b837-04429b1534f2)

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

import json
import folium
import googlemaps

import seaborn as sns
import matplotlib.pyplot as plt

import matplotlib as mpl
from matplotlib import rcParams # matplotlib 환경설정 모듈
rcParams['font.family'] = 'Malgun Gothic' # 한글 글꼴 설정
rcParams['axes.unicode_minus'] = False

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

# 지도 시각화
# 1. 구별 평균 가격
# 2. 상위 10개, 하위 10개 주유소를 시각화(위도, 경도)

# 구별(그룹) 평균(agg) 가격

gu_data=pd.pivot_table( # 인덱스로 오름차순 정렬한 결과를 dataframe로 반환
    data=stations
    , index=['구'] # 인덱스에 들어가는 값 그룹핑한다.
    , values=['가격']
    , aggfunc=np.mean
)

# 서울시 구를 경계로한 지도 표시
geo_path='./data/02. skorea_municipalities_geo_simple.json'
geo_str=json.load(
    open(
        geo_path,encoding='utf-8'
        )
    )

# 지도 생성
map=folium.Map(
    location=[37.5502,126.982]
    ,zoom_start=11
)

# 구별 경계선 : Choropleth
folium.Choropleth(
    geo_data=geo_str # 경계선 데이터 지정
    ,data=gu_data # 구별 색상값, 구별 평균 가격
    , columns=[gu_data.index,'가격']
    ,fill_color='PuRd'
    ,key_on='feature.id' #경계선 데이터에 있는 구 추출
).add_to(map)

# 상위 10개, 하위10개 변수 선언 저장
oil_price_top10 = stations.sort_values(by='가격',ascending=False).head(10)
oil_price_bottom10 = stations.sort_values(by='가격',ascending=True).head(10)

# 구글 주소 검색 설정
# gmas_key='개인키'
gmaps=googlemaps.Client(key=gmas_key)


# 상위 10개 주소에서 위도,경도 추출
from tqdm import tqdm

toplat=[]
toplng=[]
toperr=[]

for idx in tqdm(oil_price_top10.index):
    try:
        tmp_addr= oil_price_top10['주소'][idx].split('(')[0]
        tmp_map=gmaps.geocode(tmp_addr) # 잘못된 주소에 의한 에러 발생 가능
        
        tmp_loc=tmp_map[0].get('geometry')
        toplat.append(tmp_loc['location']['lat'])
        
        tmp_lng=tmp_map[0].get('geometry')
        toplng.append(tmp_loc['location']['lng'])
        
    except: #잘못된 주소가 있는 경우
        toplat.append(np.nan)
        toplng.append(np.nan)
        print('잘못된 주소 :'+idx)
        toperr.append(idx)

# Dataframe에 lat,lng 추가
oil_price_top10['lat']= toplat
oil_price_top10['lng']=toplng


bottomlat=[]
bottomlng=[]
bottomerr=[]

for idx in tqdm(oil_price_bottom10.index):
    try:
        tmp_addr= oil_price_bottom10['주소'][idx].split('(')[0]
        tmp_map=gmaps.geocode(tmp_addr) # 잘못된 주소에 의한 에러 발생 가능
        
        tmp_loc=tmp_map[0].get('geometry')
        bottomlat.append(tmp_loc['location']['lat'])
        
        tmp_lng=tmp_map[0].get('geometry')
        bottomlng.append(tmp_loc['location']['lng'])
        
    except: #잘못된 주소가 있는 경우
        bottomlat.append(np.nan)
        bottomlng.append(np.nan)
        print('잘못된 주소 :'+idx)
        bottomerr.append(idx)

# Dataframe에 lat,lng 추가
oil_price_bottom10['lat']= bottomlat
oil_price_bottom10['lng']=bottomlng

oil_price_bottom10

```
![image](https://github.com/user-attachments/assets/2da4cfe1-7396-4f72-85b4-80bd21bd4baf)

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

import json
import folium
import googlemaps

import seaborn as sns
import matplotlib.pyplot as plt

import matplotlib as mpl
from matplotlib import rcParams # matplotlib 환경설정 모듈
rcParams['font.family'] = 'Malgun Gothic' # 한글 글꼴 설정
rcParams['axes.unicode_minus'] = False

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

# 지도 시각화
# 1. 구별 평균 가격
# 2. 상위 10개, 하위 10개 주유소를 시각화(위도, 경도)

# 구별(그룹) 평균(agg) 가격

gu_data=pd.pivot_table( # 인덱스로 오름차순 정렬한 결과를 dataframe로 반환
    data=stations
    , index=['구'] # 인덱스에 들어가는 값 그룹핑한다.
    , values=['가격']
    , aggfunc=np.mean
)

# 서울시 구를 경계로한 지도 표시
geo_path='./data/02. skorea_municipalities_geo_simple.json'
geo_str=json.load(
    open(
        geo_path,encoding='utf-8'
        )
    )


# 상위 10개, 하위10개 변수 선언 저장
oil_price_top10 = stations.sort_values(by='가격',ascending=False).head(10)
oil_price_bottom10 = stations.sort_values(by='가격',ascending=True).head(10)

# 구글 주소 검색 설정
# gmas_key='개인키'
gmaps=googlemaps.Client(key=gmas_key)


# 상위 10개 주소에서 위도,경도 추출
from tqdm import tqdm

toplat=[]
toplng=[]
toperr=[]

for idx in tqdm(oil_price_top10.index):
    try:
        tmp_addr= oil_price_top10['주소'][idx].split('(')[0]
        tmp_map=gmaps.geocode(tmp_addr) # 잘못된 주소에 의한 에러 발생 가능
        
        tmp_loc=tmp_map[0].get('geometry')
        toplat.append(tmp_loc['location']['lat'])
        
        tmp_lng=tmp_map[0].get('geometry')
        toplng.append(tmp_loc['location']['lng'])
        
    except: #잘못된 주소가 있는 경우
        toplat.append(np.nan)
        toplng.append(np.nan)
        print('잘못된 주소 :'+idx)
        toperr.append(idx)

# Dataframe에 lat,lng 추가
oil_price_top10['lat']= toplat
oil_price_top10['lng']=toplng


bottomlat=[]
bottomlng=[]
bottomerr=[]

for idx in tqdm(oil_price_bottom10.index):
    try:
        tmp_addr= oil_price_bottom10['주소'][idx].split('(')[0]
        tmp_map=gmaps.geocode(tmp_addr) # 잘못된 주소에 의한 에러 발생 가능
        
        tmp_loc=tmp_map[0].get('geometry')
        bottomlat.append(tmp_loc['location']['lat'])
        
        tmp_lng=tmp_map[0].get('geometry')
        bottomlng.append(tmp_loc['location']['lng'])
        
    except: #잘못된 주소가 있는 경우
        bottomlat.append(np.nan)
        bottomlng.append(np.nan)
        print('잘못된 주소 :'+idx)
        bottomerr.append(idx)

# Dataframe에 lat,lng 추가
oil_price_bottom10['lat']= bottomlat
oil_price_bottom10['lng']=bottomlng

# 지도 생성, 상하위 10개 표시 원마커 사용
# 지도 생성
map=folium.Map(
    location=[37.5502,126.982]
    ,zoom_start=11
)

# 구별 경계선 : Choropleth
folium.Choropleth(
    geo_data=geo_str # 경계선 데이터 지정
    ,data=gu_data # 구별 색상값, 구별 평균 가격
    , columns=[gu_data.index,'가격']
    ,fill_color='PuRd'
    ,key_on='feature.id' #경계선 데이터에 있는 구 추출
).add_to(map)

# 상위 10개 표시
for idx in oil_price_top10.index:
    if pd.notnull(oil_price_top10['lat'][idx]):
        folium.CircleMarker(
            [oil_price_top10['lat'][idx],oil_price_top10['lng'][idx]]
            , radius=oil_price_top10['가격'][idx] /100
            , color='#CD8181'
            ,fill_color='#CD3181'
            , fill=True
        ).add_to(map)
map
```
![image](https://github.com/user-attachments/assets/45a5b2b3-105c-4478-8488-b35ca89c7cf0)

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

import numpy as np
import pandas as pd
from glob import glob
import os 

import json
import folium
import googlemaps

import seaborn as sns
import matplotlib.pyplot as plt

import matplotlib as mpl
from matplotlib import rcParams # matplotlib 환경설정 모듈
rcParams['font.family'] = 'Malgun Gothic' # 한글 글꼴 설정
rcParams['axes.unicode_minus'] = False

path = "./oil_data/"
file_list = os.listdir(path)

station_files=glob('./oil_data/*.xls') 

tmp_df_list =[]

for file_name in station_files:
    tmp=pd.read_excel(
        file_name,
        header=2
    ) # DataFrame
    tmp_df_list.append(tmp) 

station_raw = pd.concat(
    tmp_df_list
)

# 기존 데이터프레임에서 정리된 새로운 데이터프레임을 생성
stations=pd.DataFrame({
    '상호':station_raw['상호']
    ,'주소':station_raw['주소']
    ,'가격':station_raw['휘발유']
    ,'셀프':station_raw['셀프여부']
    ,'상표':station_raw['상표']
}
)

# 주소에서 '구'를 추출해서 새로운 '구' 컬럼 생성
stations['구']=[address.split()[1] for address in stations['주소']]

# 가격 컬럼을 실수로 변환
#stations['가격'].astype('float')

stations['가격']=[float(value) for value in stations['가격']]

#중복된 인덱스를 리셋

stations.reset_index(inplace=True) # integer index

# 생성된 index 컬럼을 삭제
del stations['index']

# 지도 시각화
# 1. 구별 평균 가격
# 2. 상위 10개, 하위 10개 주유소를 시각화(위도, 경도)

# 구별(그룹) 평균(agg) 가격

gu_data=pd.pivot_table( # 인덱스로 오름차순 정렬한 결과를 dataframe로 반환
    data=stations
    , index=['구'] # 인덱스에 들어가는 값 그룹핑한다.
    , values=['가격']
    , aggfunc=np.mean
)

# 서울시 구를 경계로한 지도 표시
geo_path='./data/02. skorea_municipalities_geo_simple.json'
geo_str=json.load(
    open(
        geo_path,encoding='utf-8'
        )
    )


# 상위 10개, 하위10개 변수 선언 저장
oil_price_top10 = stations.sort_values(by='가격',ascending=False).head(10)
oil_price_bottom10 = stations.sort_values(by='가격',ascending=True).head(10)

# 구글 주소 검색 설정
# gmas_key='개인키'
gmaps=googlemaps.Client(key=gmas_key)


# 상위 10개 주소에서 위도,경도 추출
from tqdm import tqdm

toplat=[]
toplng=[]
toperr=[]

for idx in tqdm(oil_price_top10.index):
    try:
        tmp_addr= oil_price_top10['주소'][idx].split('(')[0]
        tmp_map=gmaps.geocode(tmp_addr) # 잘못된 주소에 의한 에러 발생 가능
        
        tmp_loc=tmp_map[0].get('geometry')
        toplat.append(tmp_loc['location']['lat'])
        
        tmp_lng=tmp_map[0].get('geometry')
        toplng.append(tmp_loc['location']['lng'])
        
    except: #잘못된 주소가 있는 경우
        toplat.append(np.nan)
        toplng.append(np.nan)
        print('잘못된 주소 :'+idx)
        toperr.append(idx)

# Dataframe에 lat,lng 추가
oil_price_top10['lat']= toplat
oil_price_top10['lng']=toplng


bottomlat=[]
bottomlng=[]
bottomerr=[]

for idx in tqdm(oil_price_bottom10.index):
    try:
        tmp_addr= oil_price_bottom10['주소'][idx].split('(')[0]
        tmp_map=gmaps.geocode(tmp_addr) # 잘못된 주소에 의한 에러 발생 가능
        
        tmp_loc=tmp_map[0].get('geometry')
        bottomlat.append(tmp_loc['location']['lat'])
        
        tmp_lng=tmp_map[0].get('geometry')
        bottomlng.append(tmp_loc['location']['lng'])
        
    except: #잘못된 주소가 있는 경우
        bottomlat.append(np.nan)
        bottomlng.append(np.nan)
        print('잘못된 주소 :'+idx)
        bottomerr.append(idx)

# Dataframe에 lat,lng 추가
oil_price_bottom10['lat']= bottomlat
oil_price_bottom10['lng']=bottomlng

# 지도 생성, 상하위 10개 표시 원마커 사용
# 지도 생성
map=folium.Map(
    location=[37.5502,126.982]
    ,zoom_start=11
)

# 구별 경계선 : Choropleth
folium.Choropleth(
    geo_data=geo_str # 경계선 데이터 지정
    ,data=gu_data # 구별 색상값, 구별 평균 가격
    , columns=[gu_data.index,'가격']
    # ,fill_color='PuRd'
    ,key_on='feature.id' #경계선 데이터에 있는 구 추출
).add_to(map)

# 상위 10개 표시
for idx in oil_price_top10.index:
    if (pd.notnull(oil_price_top10['lat'][idx])& pd.notnull(oil_price_top10['lng'][idx])):
        folium.CircleMarker(
            [oil_price_top10['lat'][idx],oil_price_top10['lng'][idx]]
            , radius=oil_price_top10['가격'][idx] /100
            , color='#CD8181'
            ,fill_color='#CD3181'
            , fill=True
        ).add_to(map)

# 하위 10개 표시
for idx in oil_price_bottom10.index:
    if (pd.notnull(oil_price_bottom10['lat'][idx]) & pd.notnull(oil_price_bottom10['lng'][idx])):
        folium.CircleMarker(
            [oil_price_bottom10['lat'][idx],oil_price_bottom10['lng'][idx]]
            , radius=oil_price_bottom10['가격'][idx] /100
            , color='#327e7e'
            ,fill_color='#327e7e'
            , fill=True
        ).add_to(map)
map
```
![image](https://github.com/user-attachments/assets/97d63bbf-7e51-4b1f-b455-34c4363da09a)
