# 셀프 주유소의 휘발유 가격 분석

---
1. Selenium Library 사용
   - 원래 목적은 웹 애플리케이션 개발, 자동화 테스트를 하기 위해 만들어짐
   - 데이터 수집에 사용할 것이다.
   - selenium.webdriver : 데이터 수집에 사용
     - **웹브라우저를 제어**하고 자동화할 수 있는 API 제공
     - 다양한 브라우저 제어
2. Webdriver module
   - 브라우저 제어
     - get(url) : 지정된 url로 이동
     - back(), forward(), refresh() 등
     - maxmize_window() : 브라우저 창을 최대화
     - close() : 현재 탭 삭제
     - quit() : 전체브리핑 닫기
   - 요소 찾기
     - find_element(BY.ID, '찾고자할 id명')
     - find_element(BY.NAME, '찾고자할 태그명')
     - find_element(BY.CLASS_NAME, '찾고자할 class명')
     - find_element(BY.TAG, '찾고자할 Tag')
     - find_element(BY.CSS_Selector, 'css selector')
     - find_element(BY.XPATH, '찾고자할 xpath명') ※ xpath은 select 축약
   - 상호작용 처리
     - click() : 특정 태그를 클릭 할 때 사용
     - send_key('value') : 해당 요소에 텍스트로 value가 입력되게 할 때 사용
     - clear() : 특정 요소의 입력값을 삭제할 때 사용
     - submit() : 서버로 데이터 전송할 때 사용
     - execute_script('js code') : 자바스크립트 코드 실행


---
## Selenium 사용하기
```
pip install selenium 
```
![image](https://github.com/user-attachments/assets/c3ead0a8-cdd4-47c1-9e2d-4262a225896e)

```
# 네이버 자동 로그인 처리 : 에러 난다
from selenium import webdriver
from selenium.webdriver.common.by import By

driver=webdriver.Chrome() # 크롬 브라우저를 다룰 수 있는 오브젝트 생성
driver.get('https://nid.naver.com/nidlogin.login?mode=form&url=https://www.naver.com/')

```
![image](https://github.com/user-attachments/assets/d70f5dfb-bcbf-411b-99f7-d6321d24e812)

```
# 네이버 자동 로그인 처리 : 에러 난다
from selenium import webdriver
from selenium.webdriver.common.by import By

driver=webdriver.Chrome() # 크롬 브라우저를 다룰 수 있는 오브젝트 생성
driver.get('https://nid.naver.com/nidlogin.login?mode=form&url=https://www.naver.com/')

naver_id='abc'
naver_password='1234'

# id 입력하는 textbox 선택
id_box=driver.find_element(By.ID,'id')
id_box.send_keys(naver_id)

```
![image](https://github.com/user-attachments/assets/a72e36e4-a9ad-4e6b-9430-3bc03e7f7c68)

```
# 네이버 자동 로그인 처리 : 에러 난다
from selenium import webdriver
from selenium.webdriver.common.by import By

driver=webdriver.Chrome() # 크롬 브라우저를 다룰 수 있는 오브젝트 생성
driver.get('https://nid.naver.com/nidlogin.login?mode=form&url=https://www.naver.com/')

naver_id='abc'
naver_password='1234'

# id 입력하는 textbox 선택
id_box=driver.find_element(By.ID,'id')
id_box.send_keys(naver_id)

# 비밀번호 입력하는 textbox 선택
pw_box=driver.find_element(By.ID,'pw')
pw_box.send_keys(naver_password)

```
![image](https://github.com/user-attachments/assets/c437d42e-ede4-4f19-bc4d-964dee130b42)

```
# 네이버 자동 로그인 처리 : 에러 난다
from selenium import webdriver
from selenium.webdriver.common.by import By

driver=webdriver.Chrome() # 크롬 브라우저를 다룰 수 있는 오브젝트 생성
driver.get('https://nid.naver.com/nidlogin.login?mode=form&url=https://www.naver.com/')

naver_id='abc'
naver_password='1234'

# id 입력하는 textbox 선택
id_box=driver.find_element(By.ID,'id')
id_box.send_keys(naver_id)

# 비밀번호 입력하는 textbox 선택
pw_box=driver.find_element(By.ID,'pw')
pw_box.send_keys(naver_password)

# 로그인 버튼 누르기
login_button=driver.find_element(By.ID,'log.login')
login_button.click()
```
![image](https://github.com/user-attachments/assets/5d64ba9d-fd3e-47cf-a19a-6d7d3628c0ea)

```
# 네이버 자동 로그인 처리 : 에러 난다
from selenium import webdriver
from selenium.webdriver.common.by import By

driver=webdriver.Chrome() # 크롬 브라우저를 다룰 수 있는 오브젝트 생성
driver.get('https://nid.naver.com/nidlogin.login?mode=form&url=https://www.naver.com/')

naver_id='abc'
naver_password='1234'

# id 입력하는 textbox 선택
id_box=driver.find_element(By.ID,'id')
id_box.send_keys(naver_id)

# 비밀번호 입력하는 textbox 선택
pw_box=driver.find_element(By.ID,'pw')
pw_box.send_keys(naver_password)

# 로그인 버튼 누르기
login_button=driver.find_element(By.ID,'log.login')
login_button.click()

# 브라우저 닫기
driver.close()
```

---
## 주유소 데이터 습격

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

# 브라우저 오브젝트를 생성
driver=webdriver.Chrome()

# 화면 출력
driver.get('https://www.opinet.co.kr/searRgSelect.do')
```
![image](https://github.com/user-attachments/assets/98b5eda1-530e-4879-8a55-bdf45204aace)

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

# Initialize the WebDriver
driver = webdriver.Chrome()

# Open the target URL
driver.get('https://www.opinet.co.kr/searRgSelect.do')

# Wait for the select element to be present (e.g., up to 10 seconds)
try:
    gu_list_raw = WebDriverWait(driver, 10).until(
        EC.presence_of_element_located((By.XPATH, '//*[@id="SIGUNGU_NM0"]'))
    )
    
    # Extract the options and store them in a list
    gu_names = []
    gu_list = gu_list_raw.find_elements(By.TAG_NAME, 'option')
    
    for option in gu_list:
        gu_names.append(option.text)
    
    # Print the result as a list
    print(gu_names[1:])
    
except Exception as e:
    print(f"Error: {str(e)}")
finally:
    driver.quit()
```
![image](https://github.com/user-attachments/assets/cce372a9-c052-40a8-9148-bd599afc6959)

```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from tqdm import tqdm
import time

chrome_options = Options()

driver = webdriver.Chrome(options=chrome_options)

try:
    driver.get('https://www.opinet.co.kr/searRgSelect.do')
    

    gu_list_raw = WebDriverWait(driver, 10).until(
        EC.presence_of_element_located((By.XPATH, '//*[@id="SIGUNGU_NM0"]'))
    )
    

    gu_list = gu_list_raw.find_elements(By.TAG_NAME, 'option')
    gu_names = [option.text for option in gu_list]
    

    for gu in tqdm(gu_names[1:]):
        print('-----------------------------------------------------------')
        print(f"Processing: {gu}")
        print('-----------------------------------------------------------')
        
         # 1. select box 선택
        select_element = WebDriverWait(driver, 10).until(
            EC.element_to_be_clickable((By.ID, 'SIGUNGU_NM0'))
        )
        select_element.send_keys(gu)
        
        # 서버에서 데이터가 오는 것을 2초 기다려라
        time.sleep(2)
        
        # 2. 조회 버튼 클릭 : searRgSelect
        search_element = WebDriverWait(driver, 10).until(
            EC.element_to_be_clickable((By.ID, 'searRgSelect'))
        )
        search_element.click()
        
        # 서버에서 데이터가 오는 것을 5초 기다려라
        time.sleep(5)
        
        # 3. 엑셀 저장 버튼 선택, 클릭 -> 해당 구의 엑셀파일 다운로드가 된다.
        try:
            excel_xpath = '//*[@id="templ_list0"]/div[7]/div/a'
            excel_element = WebDriverWait(driver, 10).until(
                EC.element_to_be_clickable((By.XPATH, excel_xpath))
            )
            excel_element.click()
            
            print(f"Downloading Excel for {gu}...")
            time.sleep(10)
            
        except Exception as e:
            print(f"Error downloading Excel for {gu}: {str(e)}")

except Exception as e:
    print(f"Main error: {str(e)}")
    
finally:
    print("Closing browser...")
    driver.quit()
```
![image](https://github.com/user-attachments/assets/686cd4f4-c6e4-46a8-bacf-79872277da0e)

```
# import
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options

driver=webdriver.Chrome()
driver.get('https://www.opinet.co.kr/searRgSelect.do')

# 1. 서울시 고정, 구별 정보 추출
# select box value 추출
# 1.1 select box search selection
x_path='//*[@id="SIGUNGU_NM0"]'
gu_list_raw=driver.find_element(By.XPATH, '//*[@id="SIGUNGU_NM0"]')
gu_list=gu_list_raw.find_elements(By.TAG_NAME, 'option')
gu_list
```
![image](https://github.com/user-attachments/assets/3212bfc5-17cb-42a0-932f-f89e94f71d94)

```
gu_name = [option.get_attribute('value') for option in gu_list]

gu_name.remove('')

from tqdm import tqdm
import time #sleep

for gu in gu_name:
    #select box 선택
    select_element=driver.find_element(By.ID, 'SIGUNGU_NM0')
    # select box 값으로 보내서 데이터 갱신 : 강남구
    select_element.send_keys(gu)
    
    time.sleep(2) # 서버에서 데이터가 오는 것을 2초를 기다려라
    
    # 2. 조회 버튼 클릭 : searRgSelect
    search_element=driver.find_element(By.ID,'searRgSelect')
    search_element.click()
    
    time.sleep(2)
    
    x_path='//*[@id="templ_list0"]/div[7]/div/a'
    excel_element=driver.find_element(By.XPATH,x_path)
    excel_element.click()
    
    time.sleep(2)
```
![image](https://github.com/user-attachments/assets/6b29d7cd-c63f-4b9f-9398-beedd46020e1)

---
## 다운한 파일 데이터 분석
